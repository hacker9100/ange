define(["controller/controllers"],function(controllers){controllers.controller("series_main",["$scope","$stateParams","$location","dialogs","ngTableParams",function($scope,$stateParams,$location,dialogs,ngTableParams){$scope.key="";$scope.item={};$scope.search={};$scope.init=function(){};$scope.click_deleteSeries=function(parentIdx,idx){var series=$scope.tableParams.data[parentIdx].data[idx];var dialog=dialogs.confirm("\uc54c\ub9bc","\uc0ad\uc81c \ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c.",{size:"md"});dialog.result.then(function(btn){$scope.deleteItem("cms/series","item",series.NO,true).then(function(){dialogs.notify("\uc54c\ub9bc","\uc815\uc0c1\uc801\uc73c\ub85c \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",{size:"md"});$scope.tableParams.data[parentIdx].data.splice(idx,1)})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"})})},function(btn){return})};$scope.click_searchSeries=function(){$scope.tableParams.reload()};$scope.getSeriesList=function(){$scope.tableParams=new ngTableParams({page:1,count:1E3,sorting:{SERIES_NM:"asc"}},{groupBy:"SERIES_GB",counts:[],total:0,getData:function($defer,params){var key=Object.keys(params.sorting())[0];$scope.search["SORT"]=key;$scope.search["ORDER"]=params.sorting()[key];$scope.getList("cms/series","list",{},$scope.search,true).then(function(data){var total_cnt=data[0].TOTAL_COUNT;$scope.TOTAL_COUNT=total_cnt;params.total(total_cnt);$defer.resolve(data)})["catch"](function(error){$defer.resolve([])})}})};$scope.click_saveSeries=function(){if($scope.key=="")$scope.insertItem("cms/series","item",$scope.item,false).then(function(){dialogs.notify("\uc54c\ub9bc","\uc815\uc0c1\uc801\uc73c\ub85c \ub4f1\ub85d\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",{size:"md"});$scope.tableParams.reload()})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"})});else $scope.updateItem("cms/series","item",$scope.key,$scope.item,false).then(function(){dialogs.notify("\uc54c\ub9bc","\uc815\uc0c1\uc801\uc73c\ub85c \uc218\uc815\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",{size:"md"});$scope.tableParams.reload()})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"})});$scope.click_cancel()};$scope.click_getSeries=function(id){$scope.key=id;if($scope.key!="")$scope.getItem("cms/series","item",$scope.key,{},false).then(function(data){$scope.item=data;$scope.click_focus()})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"})})};$scope.click_updateStatus=function(item){item.SERIES_ST=item.SERIES_ST=="1"?"0":"1";$scope.updateItem("cms/series","item",item.NO,item,false).then(function(){dialogs.notify("\uc54c\ub9bc","\uc2dc\ub9ac\uc988 \uc0c1\ud0dc\uac00 \ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",{size:"md"})})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"});$scope.tableParams.reload()})};$scope.click_focus=function(){$("html,body").animate({scrollTop:$("#item").offset().top},100);$("#item_gb").focus()};$scope.click_cancel=function(){$scope.key="";$scope.item={};$scope.item.SERIES_GB="1"};$scope.getSession().then($scope.sessionCheck).then($scope.permissionCheck).then($scope.init).then($scope.getSeriesList)["catch"]($scope.reportProblems)}])});