define(["controller/controllers"],function(n){n.controller("content-edit",["$scope","$sce","$stateParams","$location","$modal","$q","dialogs","UPLOAD",function(a,m,e,k,l,h,f,g){a.click_selectTemplet=function(b){var d='<p><img class="template_handle" src="'+g.BASE_URL+'/imgs/template_handler.jpg" style="width:260px; height:14px;"/></p>';switch(b){case "handler_template":angular.isUndefined(CKEDITOR)||(c=CKEDITOR.dom.element.createFromHtml(d),CKEDITOR.instances.editor1.insertElement(c));break;case "basic_template":b=
    '<div class="story-row previewwrap"><div id="inBodyForm" class="story-col-xs-12 article_previewwrap">'+d+'</div><div class="hiddenline">'+a.item.BODY;"</div></div>";a.item.BODY=b;break;case "plantitle_template":b="<plantitle><strong>\uc139\uc158\uba85</strong> | \uc81c\ubaa9</plantitle>";if(!angular.isUndefined(CKEDITOR)){var c=CKEDITOR.dom.element.createFromHtml(b);CKEDITOR.instances.editor1.insertElement(c);c=CKEDITOR.dom.element.createFromHtml(d);CKEDITOR.instances.editor1.insertElement(c)}break;
    case "byline_template":b='<byline><div id="basic_information" class="basic_information"><strong>\ud504\ub85c\uc81d\ud2b8 [\ud638\uc81c]</strong> 2014-12-25</div><strong>\uc5d0\ub514\ud130</strong> \uc774\ub984 / <strong>\ud3ec\ud1a0\uadf8\ub798\ud37c</strong> \uc774\ub984 / <strong>\ucc38\uace0\ud55c \ucc45</strong> &lt;\uc81c\ubaa9&gt; &lt;\uc81c\ubaa9&gt; / <strong>\uc758\uc0c1 \ud611\ucc2c</strong> \uc5c5\uccb4(02-1234-5678, www.homepage.co.kr) / <strong>\ubaa8\ub378</strong> \uc774\ub984</byline>';
        angular.isUndefined(CKEDITOR)||(c=CKEDITOR.dom.element.createFromHtml(b),CKEDITOR.instances.editor1.insertElement(c),c=CKEDITOR.dom.element.createFromHtml(d),CKEDITOR.instances.editor1.insertElement(c));break;case "headline_template":c="<subtitle>\uc18c\uc81c\ubaa9\uc744 \uc785\ub825\ud558\uc138\uc694</subtitle>";b="<maintitle>\ub300\uc81c\ubaa9\uc744 \uc785\ub825\ud558\uc138\uc694</maintitle>";angular.isUndefined(CKEDITOR)||(c=CKEDITOR.dom.element.createFromHtml(c),CKEDITOR.instances.editor1.insertElement(c),
        c=CKEDITOR.dom.element.createFromHtml(b),CKEDITOR.instances.editor1.insertElement(c),c=CKEDITOR.dom.element.createFromHtml(d),CKEDITOR.instances.editor1.insertElement(c));break;case "preface_basic_template":c='<div class="imagebox"><img class="template_handle" src="'+g.BASE_URL+'/imgs/image_handler.jpg" style="float:none; width:260px; height:14px; margin:0px auto;"/></div>';b="<preface>\uc804\ubb38 \ub0b4\uc6a9\uc744 \uc785\ub825\ud558\uc138\uc694</preface>";angular.isUndefined(CKEDITOR)||(c=CKEDITOR.dom.element.createFromHtml(c),
        CKEDITOR.instances.editor1.insertElement(c),c=CKEDITOR.dom.element.createFromHtml(b),CKEDITOR.instances.editor1.insertElement(c),c=CKEDITOR.dom.element.createFromHtml(d),CKEDITOR.instances.editor1.insertElement(c));break;case "sectionmain_template":b="<sectionmain>\uc8fc\uc81c\ub97c \uc785\ub825\ud558\uc138\uc694</sectionmain>";angular.isUndefined(CKEDITOR)||(c=CKEDITOR.dom.element.createFromHtml(b),CKEDITOR.instances.editor1.insertElement(c),c=CKEDITOR.dom.element.createFromHtml(d),CKEDITOR.instances.editor1.insertElement(c));
        break;case "sectionsub_template":b="<sectionsub>\uc18c\uc8fc\uc81c\ub97c \uc785\ub825\ud558\uc138\uc694</sectionsub>";angular.isUndefined(CKEDITOR)||(c=CKEDITOR.dom.element.createFromHtml(b),CKEDITOR.instances.editor1.insertElement(c),c=CKEDITOR.dom.element.createFromHtml(d),CKEDITOR.instances.editor1.insertElement(c));break;case "bodyscript_template":b="<bodyscript>\ubcf8\ubb38 \ub0b4\uc6a9\uc744 \uc785\ub825\ud558\uc138\uc694</bodyscript>";angular.isUndefined(CKEDITOR)||(c=CKEDITOR.dom.element.createFromHtml(b),
        CKEDITOR.instances.editor1.insertElement(c),c=CKEDITOR.dom.element.createFromHtml(d),CKEDITOR.instances.editor1.insertElement(c));break;case "bodyscript_p2b_template":b='<div class="story-row"><div class="story-col-sm-6"><div class="imagebox"><img class="template_handle" src="'+g.BASE_URL+'/imgs/image_handler.jpg" style="float:none; width:260px; height:14px; margin:0px auto;"/></div><mediacaption>\uc774\ubbf8\uc9c0 \uc124\uba85\uc744 \uc785\ub825\ud558\uc138\uc694</mediacaption></div><div class="story-col-sm-6"><bodyscript>\ubcf8\ubb38 \ub0b4\uc6a9\uc744 \uc785\ub825\ud558\uc138\uc694</bodyscript></div></div>';
        angular.isUndefined(CKEDITOR)||(c=CKEDITOR.dom.element.createFromHtml(b),CKEDITOR.instances.editor1.insertElement(c),c=CKEDITOR.dom.element.createFromHtml(d),CKEDITOR.instances.editor1.insertElement(c));break;case "bodyscript_b2p_template":b='<div class="story-row"><div class="story-col-sm-6"><bodyscript>\ubcf8\ubb38 \ub0b4\uc6a9\uc744 \uc785\ub825\ud558\uc138\uc694</bodyscript></div><div class="story-col-sm-6"><div class="imagebox"><img class="template_handle" src="'+g.BASE_URL+'/imgs/image_handler.jpg" style="float:none; width:260px; height:14px; margin:0px auto;"/></div><mediacaption>\uc774\ubbf8\uc9c0 \uc124\uba85\uc744 \uc785\ub825\ud558\uc138\uc694</mediacaption></div></div>';
        angular.isUndefined(CKEDITOR)||(c=CKEDITOR.dom.element.createFromHtml(b),CKEDITOR.instances.editor1.insertElement(c),c=CKEDITOR.dom.element.createFromHtml(d),CKEDITOR.instances.editor1.insertElement(c));break;case "tips_template":b='<tips><div class="tip_title">TIP \uc81c\ubaa9\uc744 \uc785\ub825\ud558\uc138\uc694</div>\ub0b4\uc6a9\uc744 \uc785\ub825\ud558\uc138\uc694.</tips>';angular.isUndefined(CKEDITOR)||(c=CKEDITOR.dom.element.createFromHtml(b),CKEDITOR.instances.editor1.insertElement(c),c=CKEDITOR.dom.element.createFromHtml(d),
        CKEDITOR.instances.editor1.insertElement(c));break;case "2E":b='<div class="story-row"> <div class="story-col-sm-2" style="width:700px; height:500px; border:1px dashed; "></div><div class= "story-col-sm-2" style="width:700px; height:300px; border:1px dashed; ">'+a.item.BODY,"</div></div>",a.item.BODY=b}};a.renderHtml=function(a){return m.trustAsHtml(a)};a.queue=[];a.init=function(){};a.$on("ckeditor.ready",function(b){a.isReady=!0});a.ckeditor="<p>\n<p>";a.click_showContentList=function(){k.path("/"+
    e.menu+"/list")};a.click_showGetHistory=function(b){a.openHistoryModal({TASK_NO:b},"lg")};a.openHistoryModal=function(b,d){f.create("/partials/cms/popup/history.html",function(a,d,e){a.getList("cms/history","list",{},b,!0).then(function(b){a.list=b})["catch"](function(a){console.log(a)});a.list=e;a.click_ok=function(){d.close()}},b,{size:d,keyboard:!0},a).result.then(function(){},function(){})};a.getTask=function(){var b=h.defer();h.all([a.getItem("cms/task","item",e.id,{},!1).then(function(b){console.log(b);
    a.task=b}),a.getItem("cms/content","item",e.id,{},!1).then(function(b){a.item=b;b=b.FILES;for(var c in b)a.queue.push({name:b[c].FILE_NM,size:b[c].FILE_SIZE,url:g.BASE_URL+b[c].PATH+b[c].FILE_ID,thumbnailUrl:g.BASE_URL+b[c].PATH+"thumbnail/"+b[c].FILE_ID,mediumUrl:g.BASE_URL+b[c].PATH+"medium/"+b[c].FILE_ID,deleteUrl:"http://localhost/serverscript/upload/?file="+b[c].FILE_NM,deleteType:"DELETE"})})]).then(function(a){b.resolve()},function(a){b.reject(a)});return b.promise};a.click_saveContent=function(){a.item.TASK=
    a.task;a.item.FILES=a.queue;for(var b in a.item.FILES)a.item.FILES[b].$destroy="",a.item.FILES[b].$editor="";void 0==a.item.NO?(a.item.PHASE="10",a.insertItem("cms/content","new",a.item,!1).then(function(){f.notify("\uc54c\ub9bc","\uc815\uc0c1\uc801\uc73c\ub85c \ub4f1\ub85d\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",{size:"md"});a.task.PHASE="10"})["catch"](function(a){f.error("\uc624\ub958",a+"",{size:"md"})})):"20"==a.task.PHASE&&a.item.PHASE!=a.task.PHASE?a.insertItem("cms/content","version",a.item,!1).then(function(){f.notify("\uc54c\ub9bc",
    "\uc815\uc0c1\uc801\uc73c\ub85c \ub4f1\ub85d\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",{size:"md"})})["catch"](function(a){f.error("\uc624\ub958",a+"",{size:"md"})}):a.updateItem("cms/content","item",a.item.NO,a.item,!1).then(function(){f.notify("\uc54c\ub9bc","\uc815\uc0c1\uc801\uc73c\ub85c \uc218\uc815\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",{size:"md"})})["catch"](function(a){f.error("\uc624\ub958",a+"",{size:"md"})})};a.click_commitContent=function(){if("0"==a.task.PHASE)alert("\uc6d0\uace0\ub97c \ub4f1\ub85d\ud574 \uc8fc\uc138\uc694.");
else{var b="",b="10"==a.task.PHASE||"11"==a.task.PHASE||"12"==a.task.PHASE?"11":"21";a.updateStatus("cms/task","status",a.task.NO,b,!1).then(function(){k.url("/"+e.menu+"/list")})["catch"](function(a){f.error("\uc624\ub958",a+"",{size:"md"})})}};a.click_returnContent=function(){var b="",b="11"==a.task.PHASE?"11":"21";a.openApprovalModal(a.item,b)};a.click_approveContent=function(){var b="",b="11"==a.task.PHASE?"12":"22";a.openApprovalModal(a.item,b)};a.openApprovalModal=function(a,d,c){l.open({templateUrl:"content_approval_modal.html",
    controller:"content_approval_modal",size:c,resolve:{content:function(){return a},status:function(){return d}}}).result.then(function(a){},function(){console.log("\uacb0\uc7ac \uc624\ub958")})};a.click_showPreview=function(){a.openModal2(a.item.BODY,"lg")};a.openModal2=function(b,d){f.create("preview_modal.html",function(a,b,d){a.content=d;a.click_ok=function(){b.close()}},b,{size:d,keyboard:!0,backdrop:!1},a).result.then(function(){},function(){angular.equals(a.name,"")&&(a.name="You did not enter in your name!")})};
    a.initUpdate=function(){0!=e.id&&a.getTask()};if("article"==e.menu||"edit"==e.menu)a.isCommit=!0,a.isApproval=!1;else if("article-confirm"==e.menu||"edit_confirm"==e.menu)a.isCommit=!1,a.isApproval=!0;if("edit"==e.menu||"edit_confirm"==e.menu)a.isTemplet=!0;a.getSession().then(a.sessionCheck).then(a.permissionCheck).then(a.init).then(a.initUpdate)["catch"](a.reportProblems)}]);n.controller("content_approval_modal",["$scope","$stateParams","$modalInstance","dataService","content","status","$location",
    function(a,m,e,k,l,h,f){a.title="12"==h||"22"==h?"\uc2b9\uc778 \ucc98\ub9ac":"\ubc18\ub824 \ucc98\ub9ac";a.approval={};a.approval.TASK_NO=l.TASK_NO;a.approval.CONTENT_NO=l.NO;a.approval.APPROVAL_ST=h;a.click_ok=function(){k.db("com/approval").insert("item",a.approval,function(a,b){200!=b?alert("\uacb0\uc7ac\uc5d0 \uc2e4\ud328 \ud588\uc2b5\ub2c8\ub2e4."):(console.log(JSON.stringify(a)),a.err?alert(a.msg):(f.url("/"+m.menu+"/list"),e.dismiss()))})};a.click_cancel=function(){e.dismiss("cancel")}}])});