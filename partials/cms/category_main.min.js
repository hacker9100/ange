define(["controller/controllers"],function(controllers){controllers.controller("category_main",["$scope","$stateParams","$location","dialogs",function($scope,$stateParams,$location,dialogs){$scope.key="";$scope.item={};$scope.search={};$scope.init=function(){$scope.getList("cms/category","list",{},{CATEGORY_GB:"2",PARENT_NO:"0"},false).then(function(data){$scope.parents=data})["catch"](function(error){console.log(error)})};$scope.click_deleteCategory=function(idx){var category=$scope.list[idx];var dialog=dialogs.confirm("\uc54c\ub9bc","\uc0ad\uc81c \ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c.",{size:"md"});dialog.result.then(function(btn){$scope.deleteItem("cms/category","item",category.NO,true).then(function(){dialogs.notify("\uc54c\ub9bc","\uc815\uc0c1\uc801\uc73c\ub85c \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",{size:"md"});$scope.list.splice(idx,1)})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"})})})};$scope.searchCategory=function(){$scope.getCategoryList($scope.search)};$scope.getCategoryList=function(search){$scope.getList("cms/category","list",{},search,true).then(function(data){$scope.list=data})["catch"](function(error){$scope.list=[]})};$scope.click_saveCategory=function(){if($scope.key=="")$scope.insertItem("cms/category","item",$scope.item,false).then(function(){dialogs.notify("\uc54c\ub9bc","\uc815\uc0c1\uc801\uc73c\ub85c \ub4f1\ub85d\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",{size:"md"});$scope.getCategoryList()})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"})});else $scope.updateItem("cms/category","item",$scope.key,$scope.item,false).then(function(){dialogs.notify("\uc54c\ub9bc","\uc815\uc0c1\uc801\uc73c\ub85c \uc218\uc815\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",{size:"md"});$scope.getCategoryList()})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"})});$scope.key=""};$scope.click_getCategory=function(id){$scope.key=id;if($scope.key!="")$scope.getItem("cms/category","item",$scope.key,{},false).then(function(data){var idx=0;for(var i=0;i<$scope.parents.length;i++)if(data.PARENT_NO==$scope.parents[i].NO)idx=i;$scope.item=data;$scope.item.PARENT=data.PARENT_NO=="0"?null:$scope.parents[idx];$scope.click_focus()})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"})})};$scope.click_focus=function(){$("html,body").animate({scrollTop:$("#item").offset().top},100);$("#item_gb").focus()};$scope.click_updateStatus=function(idx){var category=$scope.list[idx];category.CATEGORY_ST=category.CATEGORY_ST=="1"?"0":"1";$scope.updateItem("cms/category","item",category.NO,category,false).then(function(){dialogs.notify("\uc54c\ub9bc","\uc0ac\uc6a9\uc790 \uc0c1\ud0dc\uac00 \ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",{size:"md"});$scope.getCategoryList()})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"})})};$scope.click_cancel=function(){$scope.key="";$scope.item=null};$scope.getSession().then($scope.sessionCheck).then($scope.permissionCheck).then($scope.init).then($scope.getCategoryList)["catch"]($scope.reportProblems)}])});