define(["controller/controllers"],function(controllers){controllers.controller("content_view",["$scope","$sce","$rootScope","$stateParams","$location","$q","dialogs","UPLOAD",function($scope,$sce,$rootScope,$stateParams,$location,$q,dialogs,UPLOAD){$scope.queue=[];$scope.item={};$scope.init=function(session){};$scope.click_showContentEdit=function(item){if(!($rootScope.role=="CMS_ADMIN"||$rootScope.role=="MANAGER"||$rootScope.role=="MAGAZINE")&&$rootScope.uid!=item.EDITOR_ID){dialogs.notify("\uc54c\ub9bc","\uc218\uc815 \uad8c\ud55c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.",{size:"md"});return}$location.url("/"+$stateParams.menu+"/edit/"+$stateParams.id)};$scope.click_showContentList=function(){$location.path("/"+$stateParams.menu+"/list")};$scope.click_showGetHistory=function(key){$scope.openHistoryModal({TASK_NO:key},"lg")};$scope.openHistoryModal=function(item,size){var dlg=dialogs.create("/partials/cms/history.html",function($scope,$controller,$modalInstance,data){angular.extend(this,$controller("cms_common",{$scope:$scope}));$scope.getList("cms/history","list",{},item,true).then(function(data){$scope.list=data})["catch"](function(error){console.log(error)});$scope.list=data;$scope.click_ok=function(){$modalInstance.close()}},item,{size:size,keyboard:true});dlg.result.then(function(){},function(){})};$scope.getTask=function(){var deferred=$q.defer();$scope.getItem("cms/task","item",$stateParams.id,{},false).then(function(data){$scope.task=data;deferred.resolve()})["catch"](function(error){console.log(error);deferred.reject(error)});return deferred.promise};$scope.getContent=function(){var search={};if($stateParams.menu.indexOf("article")>-1&&$scope.task.PHASE>=20)search={CURRENT_FL:"N"};$scope.getItem("cms/content","item",$stateParams.id,search,false).then(function(data){$scope.item=data;var body=data.BODY.replace(/border:1px dashed;/g,"");$scope.item.BODY=$sce.trustAsHtml(body);var files=data.FILES;for(var i in files)$scope.queue.push({"name":files[i].FILE_NM,"size":files[i].FILE_SIZE,"url":UPLOAD.BASE_URL+files[i].PATH+files[i].FILE_ID,"thumbnailUrl":UPLOAD.BASE_URL+files[i].PATH+"thumbnail/"+files[i].FILE_ID,"mediumUrl":UPLOAD.BASE_URL+files[i].PATH+"medium/"+files[i].FILE_ID,"deleteUrl":"http://localhost/serverscript/upload/?file="+files[i].FILE_NM,"deleteType":"DELETE"})})["catch"](function(error){console.log(error)})};$scope.getSession().then($scope.sessionCheck).then($scope.init).then($scope.getTask).then($scope.getContent)["catch"]($scope.reportProblems)}])});