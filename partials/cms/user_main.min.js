define(["controller/controllers"],function(controllers){controllers.controller("user_main",["$scope","$stateParams","$location","$filter","dialogs","ngTableParams",function($scope,$stateParams,$location,$filter,dialogs,ngTableParams){var check=false;$scope.key="";$scope.item={};$scope.search={SYSTEM_GB:"CMS"};$scope.init=function(){$scope.getList("com/permission","list",{},{SYSTEM_GB:"CMS"},false).then(function(data){$scope.roles=data;$scope.user_roles=data;$scope.item.ROLE=data[0]})["catch"](function(error){console.log(error)})};$scope.click_deleteCmsUser=function(parentIdx,idx){var user=$scope.tableParams.data[parentIdx].data[idx];var dialog=dialogs.confirm("\uc54c\ub9bc","\uc0ad\uc81c \ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c.",{size:"md"});dialog.result.then(function(btn){$scope.deleteItem("com/user","item",user.USER_ID,true).then(function(){dialogs.notify("\uc54c\ub9bc","\uc815\uc0c1\uc801\uc73c\ub85c \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",{size:"md"});$scope.tableParams.data[parentIdx].data.splice(idx,1)})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"})})},function(btn){return})};$scope.click_searchCmsUser=function(){$scope.tableParams.reload()};$scope.getCmsUserList=function(){$scope.tableParams=new ngTableParams({page:1,count:1E3,sorting:{USER_NM:"asc"}},{groupBy:"ROLE_NM",counts:[],total:0,getData:function($defer,params){var key=Object.keys(params.sorting())[0];$scope.search["SORT"]=key;$scope.search["ORDER"]=params.sorting()[key];$scope.getList("com/user","list",{},$scope.search,true).then(function(data){var total_cnt=data[0].TOTAL_COUNT;$scope.TOTAL_COUNT=total_cnt;params.total(total_cnt);$defer.resolve(data)})["catch"](function(error){$defer.resolve([])})}})};$scope.click_saveCmsUser=function(){$scope.item.SYSTEM_GB="CMS";if($scope.key==""){if(!check){dialogs.notify("\uc54c\ub9bc","\uc544\uc774\ub514 \ud655\uc778\uc744 \ud574\uc8fc\uc138\uc694.",{size:"md"});return}$scope.insertItem("com/user","item",$scope.item,false).then(function(){dialogs.notify("\uc54c\ub9bc","\uc815\uc0c1\uc801\uc73c\ub85c \ub4f1\ub85d\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",{size:"md"});$scope.tableParams.reload()})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"})})}else $scope.updateItem("com/user","item",$scope.key,$scope.item,false).then(function(){dialogs.notify("\uc54c\ub9bc","\uc815\uc0c1\uc801\uc73c\ub85c \uc218\uc815\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",{size:"md"});$scope.tableParams.reload()})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"})});$scope.click_cancel()};$scope.click_getCmsUser=function(id){$scope.key=id;if($scope.key!="")$scope.getItem("com/user","item",$scope.key,{SYSTEM_GB:"CMS"},false).then(function(data){var idx=0;for(var i=0;i<$scope.user_roles.length;i++)if(JSON.stringify(data.ROLE)==JSON.stringify($scope.user_roles[i]))idx=i;check=true;$scope.item=data;$scope.item.ROLE=$scope.user_roles[idx];$scope.click_focus()})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"})})};$scope.click_updateStatus=function(item){item.USER_ST=item.USER_ST=="N"?"F":"N";$scope.updateItem("com/user","item",item.USER_ID,item,false).then(function(){dialogs.notify("\uc54c\ub9bc","\uc0ac\uc6a9\uc790 \uc0c1\ud0dc\uac00 \ubcc0\uacbd\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",{size:"md"})})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"});$scope.tableParams.reload()})};$scope.click_focus=function(){$("html,body").animate({scrollTop:$("#item").offset().top},100);$("#item_id").focus()};$scope.click_cancel=function(){check=false;$scope.key="";$scope.item={};$scope.item.ROLE=$scope.user_roles[0]};$scope.click_checkUserId=function(){$scope.getItem("com/user","check",$scope.item.USER_ID,{SYSTEM_GB:"CMS"},false).then(function(data){if(data.COUNT<1){check=true;dialogs.notify("\uc54c\ub9bc","\uc0ac\uc6a9 \uac00\ub2a5\ud55c \uc544\uc774\ub514\uc785\ub2c8\ub2e4.",{size:"md"})}else dialogs.notify("\uc54c\ub9bc","\uc774\ubbf8 \uc874\uc7ac\ud558\ub294 \uc544\uc774\ub514\uc785\ub2c8\ub2e4.",{size:"md"})})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"})})};$scope.$watch("item.USER_ID",function(data){check=false});$scope.getSession().then($scope.sessionCheck).then($scope.permissionCheck).then($scope.init).then($scope.getCmsUserList)["catch"]($scope.reportProblems)}])});