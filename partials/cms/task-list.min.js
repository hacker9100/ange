define(["controller/controllers"],function(k){k.controller("task-list",["$scope","$rootScope","$stateParams","$location","dialogs","COMMON",function(a,d,c,h,g,k){a.listData=[];a.search={};a.CATEGORY=[];a.category=[];a.select_settings={externalIdProp:"",idProp:"NO",displayProp:"CATEGORY_NM",dynamicTitle:!1,showCheckAll:!1,showUncheckAll:!1};var l=[],m=(new Date).getFullYear();a.init=function(){a.oneAtATime=!0;for(var b=m-5;b<m+5;b++)l.push(b+"");var b=a.getList("cms/category","list",{},{},!1).then(function(b){a.category=
    b;var e=[],d=[],c;for(c in b){var f=b[c];"1"==f.CATEGORY_GB&&"0"==f.CATEGORY_ST?e.push(f):"2"==f.CATEGORY_GB&&"0"==f.CATEGORY_ST&&"0"==f.PARENT_NO&&d.push(f)}a.category_a=e;a.category_b=d})["catch"](function(a){console.log(a)}),e=[{name:"\uae30\uc790",value:"EDITOR_NM"},{name:"\uc81c\ubaa9+\ub0b4\uc6a9",value:"SUBJECT"}];a.years=l;a.condition=e;a.search.CONDITION=e[0];return b};a.$watch("CATEGORY_M",function(b){var e=[];if(void 0!=b)for(var d in a.category){var c=a.category[d];c.PARENT_NO==b.NO&&
    "2"==c.CATEGORY_GB&&"0"==c.CATEGORY_ST&&"0"!=c.PARENT_NO&&e.push(c)}a.category_s=e});a.click_removeCategory=function(b){a.CATEGORY.splice(b,1)};a.$watch("search.YEAR",function(b){null!=b&&a.getList("cms/project","list",{},{YEAR:b},!1).then(function(b){a.projects=b})["catch"](function(b){a.projects=[];console.log(b)})});a.click_createNewTask=function(){h.url("/task/edit/0")};a.click_showViewTask=function(a){h.url("/task/view/"+a)};a.click_showEditTask=function(a){"CMS_ADMIN"!=d.role&&"MANAGER"!=d.role&&
    d.uid!=a.REG_UID?g.notify("\uc54c\ub9bc","\uc218\uc815 \uad8c\ud55c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.",{size:"md"}):h.url("/task/edit/"+a.NO)};a.click_showViewContent=function(a){h.url("/"+c.menu+"/view/"+a)};a.click_showEditContent=function(a){"CMS_ADMIN"!=d.role&&"MANAGER"!=d.role&&"MAGAZINE"!=d.role&&d.uid!=a.EDITOR_ID?g.notify("\uc54c\ub9bc","\uc218\uc815 \uad8c\ud55c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.",{size:"md"}):h.url("/"+c.menu+"/edit/"+a.NO)};a.click_showGetHistory=function(b){a.openModal({TASK_NO:b},
    "lg")};a.openModal=function(b,c){g.create("/partials/cms/popup/history.html",function(a,c,e){a.getList("cms/history","list",{},b,!0).then(function(b){a.list=b})["catch"](function(a){console.log(a)});a.list=e;a.click_ok=function(){c.close()}},b,{size:c,keyboard:!0},a).result.then(function(){},function(){})};a.click_deleteTask=function(b){b=a.list[b];"30"==b.PHASE?g.notify("\uc54c\ub9bc","\uc644\ub8cc \uc0c1\ud0dc\uc758 \ud0dc\uc2a4\ud06c\ub294 \uc0ad\uc81c\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.",{size:"md"}):
    a.deleteItem("cms/task","item",b.NO,!0).then(function(){g.notify("\uc54c\ub9bc","\uc0ad\uc81c \ub418\uc5c8\uc2b5\ub2c8\ub2e4.",{size:"md"})})["catch"](function(a){g.error("\uc624\ub958",a+"",{size:"md"})})};a.PAGE_SIZE=k.PAGE_SIZE;a.list=[];a.pageNo=0;a.pageSize=a.PAGE_SIZE;a.perCnt=0;a.perSize=a.PAGE_SIZE/2;a.totalCnt=0;a.click_searchTask=function(){a.list=[];a.listData=[];a.pageNo=0;a.perCnt=0;a.search.CATEGORY=a.CATEGORY;a.getTaskList()};a.getTaskList=function(){a.isLoading=!0;a.getList("cms/task",
    "list",{NO:a.pageNo,SIZE:a.pageSize},a.search,!0).then(function(b){var c=b[0].TOTAL_COUNT;a.TOTAL_COUNT=c;a.totalCnt=c;angular.forEach(b,function(b){a.listData.push(b)});0==a.list.length&&(a.list=a.listData.slice(a.perCnt,a.perSize))})["catch"](function(b){a.TOTAL_COUNT=0;console.log(b)})["finally"](function(){a.isLoading=!1})};a.$watch("perCnt",function(){a.perCnt>=a.list.length&&angular.forEach(a.listData.slice(a.perCnt,a.perCnt+a.perSize),function(b){a.list.push(b)})});a.addTask=function(){a.perCnt+=
    a.perSize;!(a.perCnt+a.perSize>=a.totalCnt)&&a.perCnt+a.perSize>=a.listData.length&&(a.pageNo++,a.getTaskList())};a.isTask=!1;a.isEdit=!0;"archive"==c.menu?(a.search={PHASE:"31"},a.isTask=!1,a.isEdit=!1,a.viewContentBtn="\uc6d0\uace0 \uc870\ud68c",a.editContentBtn="\uc6d0\uace0 \uc791\uc131"):"article"==c.menu?(a.search={PHASE:"0, 10, 11, 12"},a.viewContentBtn="\uc6d0\uace0 \uc870\ud68c",a.editContentBtn="\uc6d0\uace0 \uc791\uc131"):"article-confirm"==c.menu?(a.search={PHASE:"11, 12, 13"},a.viewContentBtn=
    "\uc6d0\uace0 \uc870\ud68c",a.editContentBtn="\uc6d0\uace0 \uac80\uc218"):"edit"==c.menu?(a.search={PHASE:"13, 20, 21, 22"},a.viewContentBtn="\ud3b8\uc9d1 \uc870\ud68c",a.editContentBtn="\ud3b8\uc9d1 \uc791\uc131"):"edit_confirm"==c.menu?(a.search={PHASE:"21, 22, 30"},a.viewContentBtn="\ud3b8\uc9d1 \uc870\ud68c",a.editContentBtn="\ud3b8\uc9d1 \uac80\uc218"):(a.isTask=!0,a.search={},a.viewContentBtn="\uc6d0\uace0 \uc870\ud68c",a.editContentBtn="\uc6d0\uace0 \uc791\uc131");a.getSession().then(a.sessionCheck).then(a.permissionCheck)["catch"](a.reportProblems);
    a.init();a.getTaskList()}])});