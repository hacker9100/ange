define(["controller/controllers"],function(controllers){controllers.controller("cms_common",["$timeout","$scope","$rootScope","$stateParams","$location","$q","dataService","dialogs","login",function($timeout,$scope,$rootScope,$stateParams,$location,$q,dataService,dialogs,login){$scope.test="/partials/cms/task_edit.html";$scope.test_ctr="task_edit";$scope.layoutMenu=$stateParams.menu;$scope.layoutType=$stateParams.type;$scope.includeName=$stateParams.menu+"_"+$stateParams.type;$rootScope.PAGE_SIZE=20;$scope.path=$location.path();$scope.formatFileSize=function(bytes){if(bytes>=1E9)return(bytes/1E9).toFixed(2)+" GB";if(bytes>=1E6)return(bytes/1E6).toFixed(2)+" MB";return(bytes/1E3).toFixed(2)+" KB"};$scope.login=function(key,item){var deferred=$q.defer();dataService.login(key,item,function(data,status){if(status!=200){console.log("\ub85c\uadf8\uc778\uc5d0 \uc2e4\ud328 \ud588\uc2b5\ub2c8\ub2e4.");deferred.reject("\ub85c\uadf8\uc778\uc5d0 \uc2e4\ud328 \ud588\uc2b5\ub2c8\ub2e4.")}else if(data.err==true){console.log(data.msg);deferred.reject(data.msg)}else if(angular.isObject(data))deferred.resolve(data);else{console.log("\uc544\uc774\ub514\ub098 \ud328\uc2a4\uc6cc\ub4dc\uac00 \uc77c\uce58\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.");deferred.reject("\uc544\uc774\ub514\ub098 \ud328\uc2a4\uc6cc\ub4dc\uac00 \uc77c\uce58\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.")}});return deferred.promise};$scope.logout=function(key){var deferred=$q.defer();dataService.logout(key,function(data,status){if(status!=200){console.log("\ub85c\uadf8\uc544\uc6c3\uc5d0 \uc2e4\ud328 \ud588\uc2b5\ub2c8\ub2e4.");deferred.reject("\ub85c\uadf8\uc544\uc6c3\uc5d0 \uc2e4\ud328 \ud588\uc2b5\ub2c8\ub2e4.")}else if(data.err==true){console.log(data.msg);deferred.reject(data.msg)}else if(angular.isObject(data)){$rootScope.session=null;$rootScope.authenticated=true;$rootScope.uid=null;$rootScope.name=null;$rootScope.role=null;$rootScope.menu_role=null;$rootScope.email=null;deferred.resolve(data)}else{console.log("\ub85c\uadf8\uc544\uc6c3\uc5d0 \ud328\uc2a4\uc6cc\ub4dc\uac00 \uc77c\uce58\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.");deferred.reject("\ub85c\uadf8\uc544\uc6c3\uc5d0 \ud328\uc2a4\uc6cc\ub4dc\uac00 \uc77c\uce58\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.")}});return deferred.promise};$scope.getSession=function(){var deferred=$q.defer();dataService.getSession(function(data,status){if(status!=200){$location.path("/signin");console.log("\uc870\ud68c\uc5d0 \uc2e4\ud328 \ud588\uc2b5\ub2c8\ub2e4.");deferred.reject("\uc870\ud68c\uc5d0 \uc2e4\ud328 \ud588\uc2b5\ub2c8\ub2e4.")}else if(data.err==true){$location.path("/signin");console.log(data.msg);deferred.reject(data.msg)}else if(angular.isObject(data))deferred.resolve(data);else{$location.path("/signin");console.log("\uc870\ud68c \ub370\uc774\ud130\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.");deferred.reject("\uc870\ud68c \ub370\uc774\ud130\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.")}});return deferred.promise};$scope.sessionCheck=function(session){if(session.USER_ID==undefined){$location.path("/signin");throw new String("\uc138\uc158\uc774 \ub9cc\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4.");}else if(session.USER_ID==""){$location.path("/signin");throw new String("\ub85c\uadf8\uc778 \ud6c4 \uc0ac\uc6a9\uac00\ub2a5\ud569\ub2c8\ub2e4.");}else{$rootScope.session=session;$rootScope.authenticated=true;$rootScope.uid=session.USER_ID;$rootScope.name=session.USER_NM;$rootScope.role=session.ROLE_ID;$rootScope.menu_role=session.MENU_ROLE;$rootScope.email=session.EMAIL}return};$scope.permissionCheck=function(url,back){var path=$location.path();if($rootScope.session==undefined||$rootScope.session==null){if(back)throw new String("\ub85c\uadf8\uc778 \ud6c4 \uc0ac\uc6a9\uac00\ub2a5\ud569\ub2c8\ub2e4.");else dialogs.error("\uc624\ub958","\ub85c\uadf8\uc778 \ud6c4 \uc0ac\uc6a9\uac00\ub2a5\ud569\ub2c8\ub2e4.",{size:"md"});$location.path("/signin");return false}if(url)path=url;var spMenu=path.split("/");var menuId=spMenu[1];var menuGb="";if(spMenu.length>1)menuGb=spMenu[2];if(menuId=="content"){menuId=spMenu[2];menuGb=spMenu[3]}for(var idx in $rootScope.session.MENU_ROLE){var permission=false;var role=$rootScope.session.MENU_ROLE[idx];if(menuId=="signup"||menuId=="signin")permission=true;if(role.MENU_ID==menuId){if(spMenu.length<3&&role.MENU_FL=="0")permission=true;else switch(menuGb){case "main":if(role.MENU_FL=="0")permission=true;break;case "list":if(role.LIST_FL=="0")permission=true;break;case "view":if(role.VIEW_FL=="0")permission=true;break;case "edit":if(role.EDIT_FL=="0")permission=true;break}if(!permission)if(back){history.back();throw new String("\uc811\uadfc\ud560 \uc218 \uc5c6\ub294 \uba54\ub274 \uc785\ub2c8\ub2e4.");return}else{dialogs.error("\uc624\ub958","\uc811\uadfc\ud560 \uc218 \uc5c6\ub294 \uba54\ub274 \uc785\ub2c8\ub2e4.",{size:"md"});return false}}}return true};$scope.reportProblems=function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"})};$scope.getList=function(service,type,page,search,loding){var deferred=$q.defer();if(loding)$scope.isLoading=true;dataService.db(service).find(type,page,search,function(data,status){if(status!=200){console.log("\uc870\ud68c\uc5d0 \uc2e4\ud328 \ud588\uc2b5\ub2c8\ub2e4.");deferred.reject("\uc870\ud68c\uc5d0 \uc2e4\ud328 \ud588\uc2b5\ub2c8\ub2e4.")}else if(data.err==true){console.log(data.msg);deferred.reject(data.msg)}else if(angular.isObject(data))deferred.resolve(data);else{console.log("\uc870\ud68c \ub370\uc774\ud130\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.");deferred.reject("\uc870\ud68c \ub370\uc774\ud130\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.")}if(loding)$scope.isLoading=false});return deferred.promise};$scope.getItem=function(service,type,key,search,loding){var deferred=$q.defer();if(loding)$scope.isLoading=true;dataService.db(service).findOne(type,key,search,function(data,status){if(status!=200){console.log("\uc870\ud68c\uc5d0 \uc2e4\ud328 \ud588\uc2b5\ub2c8\ub2e4.");deferred.reject("\uc870\ud68c\uc5d0 \uc2e4\ud328 \ud588\uc2b5\ub2c8\ub2e4.")}else if(data.err==true){console.log(data.msg);deferred.reject(data.msg)}else if(angular.isObject(data))deferred.resolve(data);else{console.log("\uc870\ud68c \ub370\uc774\ud130\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.");deferred.reject("\uc870\ud68c \ub370\uc774\ud130\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.")}if(loding)$scope.isLoading=false});return deferred.promise};$scope.insertItem=function(service,type,item,loding){var deferred=$q.defer();if(loding)$scope.isLoading=true;dataService.db(service).insert(type,item,function(data,status){if(status!=200){console.log("\ub4f1\ub85d\uc5d0 \uc2e4\ud328 \ud588\uc2b5\ub2c8\ub2e4.");deferred.reject("\ub4f1\ub85d\uc5d0 \uc2e4\ud328 \ud588\uc2b5\ub2c8\ub2e4.")}else if(data.err==true){console.log(data.msg);deferred.reject(data.msg)}else deferred.resolve();if(loding)$scope.isLoading=false});return deferred.promise};$scope.updateItem=function(service,type,key,item,loding){var deferred=$q.defer();if(loding)$scope.isLoading=true;dataService.db(service).update(type,key,item,function(data,status){if(status!=200){console.log("\uc218\uc815\uc5d0 \uc2e4\ud328 \ud588\uc2b5\ub2c8\ub2e4.");deferred.reject("\uc218\uc815\uc5d0 \uc2e4\ud328 \ud588\uc2b5\ub2c8\ub2e4.")}else if(data.err==true){console.log(data.msg);deferred.reject(data.msg)}else deferred.resolve();if(loding)$scope.isLoading=false});return deferred.promise};$scope.updateStatus=function(service,type,key,phase,loding){var deferred=$q.defer();if(loding)$scope.isLoading=true;dataService.updateStatus(service,type,key,phase,function(data,status){if(status!=200){console.log("\uc218\uc815\uc5d0 \uc2e4\ud328 \ud588\uc2b5\ub2c8\ub2e4.");deferred.reject("\uc218\uc815\uc5d0 \uc2e4\ud328 \ud588\uc2b5\ub2c8\ub2e4.")}else if(data.err==true){console.log(data.msg);deferred.reject(data.msg)}else deferred.resolve();if(loding)$scope.isLoading=false});return deferred.promise};$scope.deleteItem=function(service,type,key,loding){var deferred=$q.defer();if(loding)$scope.isLoading=true;dataService.db(service).remove(type,key,function(data,status){if(status!=200){console.log("\uc0ad\uc81c\uc5d0 \uc2e4\ud328 \ud588\uc2b5\ub2c8\ub2e4.");deferred.reject("\uc0ad\uc81c\uc5d0 \uc2e4\ud328 \ud588\uc2b5\ub2c8\ub2e4.")}else if(data.err==true){console.log(data.msg);deferred.reject(data.msg)}else deferred.resolve();if(loding)$scope.isLoading=false});return deferred.promise}}])});