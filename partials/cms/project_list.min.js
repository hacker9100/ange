define(["controller/controllers"],function(controllers){controllers.controller("project_list",["$scope","$rootScope","$stateParams","$location","dialogs","ngTableParams","COMMON",function($scope,$rootScope,$stateParams,$location,dialogs,ngTableParams,COMMON){$scope.search={};var year=[];var now=new Date;var nowYear=now.getFullYear();$scope.init=function(){for(var i=2010;i<nowYear+5;i++)year.push(i+"");var condition=[{name:"\ub4f1\ub85d\uc790",value:"REG_NM"},{name:"\uc81c\ubaa9+\ub0b4\uc6a9",value:"SUBJECT"}];$scope.years=year;$scope.conditions=condition;$scope.search.CONDITION=condition[0]};$scope.click_createNewProject=function(){$location.path("/project/edit/0")};$scope.click_showViewProject=function(key){$location.url("/project/view/"+key)};$scope.click_showEditProject=function(item){if(!($rootScope.role=="CMS_ADMIN"||$rootScope.role=="MANAGER")&&$rootScope.uid!=item.REG_UID){dialogs.notify("\uc54c\ub9bc","\uc218\uc815 \uad8c\ud55c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.",{size:"md"});return}$location.path("/project/edit/"+item.NO)};$scope.click_deleteProject=function(item){if(item.PROJECT_ST=="3"){dialogs.notify("\uc54c\ub9bc","\uc644\ub8cc \uc0c1\ud0dc\uc758 \ud504\ub85c\uc81d\ud2b8\ub294 \uc0ad\uc81c\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.",{size:"md"});return}if(!($rootScope.role=="ADMIN"||$rootScope.role=="MANAGER")&&$rootScope.uid!=item.REG_UID){dialogs.notify("\uc54c\ub9bc","\uc0ad\uc81c \uad8c\ud55c\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.",{size:"md"});return}var dialog=dialogs.confirm("\uc54c\ub9bc","\uc0ad\uc81c \ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c.",{size:"md"});dialog.result.then(function(btn){$scope.deleteItem("cms/project","item",item.NO,false).then(function(){dialogs.notify("\uc54c\ub9bc","\uc815\uc0c1\uc801\uc73c\ub85c \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",{size:"md"});$scope.tableParams.reload()})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"})})},function(btn){return})};$scope.click_searchProject=function(){$scope.tableParams.reload()};$scope.PAGE_SIZE=COMMON.PAGE_SIZE;$scope.getProjectList=function(){$scope.tableParams=new ngTableParams({page:1,count:$scope.PAGE_SIZE,sorting:{REG_DT:"desc"}},{counts:[],total:0,getData:function($defer,params){var key=Object.keys(params.sorting())[0];$scope.search["SORT"]=key;$scope.search["ORDER"]=params.sorting()[key];$scope.getList("cms/project","list",{NO:params.page()-1,SIZE:$scope.PAGE_SIZE},$scope.search,true).then(function(data){var total_cnt=data[0].TOTAL_COUNT;$scope.TOTAL_COUNT=total_cnt;params.total(total_cnt);$defer.resolve(data)})["catch"](function(error){$scope.TOTAL_COUNT=0;$defer.resolve([])})}})};$scope.$watch("selectItems * selectCount < itemsPerPage * currentPage",function(){$scope.selectCount=$scope.selectCount+1});$scope.getSession().then($scope.sessionCheck).then($scope.permissionCheck)["catch"]($scope.reportProblems);$scope.init();$scope.getProjectList()}])});