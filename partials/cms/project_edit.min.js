define(["controller/controllers"],function(controllers){controllers.controller("project_edit",["$scope","$stateParams","$location","dialogs","UPLOAD",function($scope,$stateParams,$location,dialogs,UPLOAD){$scope.options={url:UPLOAD.UPLOAD_INDEX,autoUpload:true,dropZone:angular.element("#dropzone")};$scope.$watch("newFile",function(data){if(typeof data!=="undefined")$scope.file=data[0]});$scope.item={};$scope.series=[];var year=[];var now=new Date;var nowYear=now.getFullYear();$scope.init=function(session){var ret=$scope.getList("cms/series","list",{},{},false).then(function(data){$scope.series=data;if($stateParams.id==0){var arr_series=[];for(var i in $scope.series){var item=$scope.series[i];if(item.SERIES_GB==$scope.TYPE)arr_series.push(item)}$scope.arr_series=arr_series;$scope.item.SERIES=arr_series[0]}})["catch"](function(error){throw"\uc2dc\ub9ac\uc988:"+error;});for(var i=2010;i<nowYear+5;i++)year.push(i+"");$scope.years=year;$scope.item.YEAR=nowYear+"";return ret};$scope.$watch("TYPE",function(data){var arr_series=[];if(data!=undefined){for(var i in $scope.series){var item=$scope.series[i];if(item.SERIES_GB==data)arr_series.push(item)}$scope.arr_series=arr_series;$scope.item.SERIES=arr_series[0]}});$scope.click_showProjectList=function(){$location.url("/project/list")};$scope.getProject=function(){if($stateParams.id!=0)return $scope.getItem("cms/project","item",$stateParams.id,{},false).then(function(data){$scope.item=data;$scope.TYPE=data.SERIES.SERIES_GB;angular.forEach($scope.series,function(value,idx){if(JSON.stringify(value)==JSON.stringify(data.SERIES)){$scope.item.SERIES=$scope.series[idx];return}});var file=data.FILE;for(var i in file)$scope.file={"name":file[0].FILE_NM,"size":file[0].FILE_SIZE,"url":UPLOAD.BASE_URL+file[0].PATH+file[0].FILE_ID,"thumbnailUrl":UPLOAD.BASE_URL+file[0].PATH+"thumbnail/"+file[0].FILE_ID,"mediumUrl":UPLOAD.BASE_URL+file[0].PATH+"medium/"+file[0].FILE_ID,"deleteUrl":"http://localhost/serverscript/upload/?file="+file[0].FILE_NM,"deleteType":"DELETE"}})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"})});else $scope.TYPE=1};$scope.click_saveProject=function(){$scope.item.FILE=$scope.file;$scope.item.FILE.$destroy="";if($stateParams.id==0)$scope.insertItem("cms/project","item",$scope.item,false).then(function(){$location.url("/project/list")})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"})});else $scope.updateItem("cms/project","item",$stateParams.id,$scope.item,false).then(function(){$location.url("/project/list")})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"})})};$scope.getSession().then($scope.sessionCheck).then($scope.permissionCheck).then($scope.init).then($scope.getProject)["catch"]($scope.reportProblems)}])});