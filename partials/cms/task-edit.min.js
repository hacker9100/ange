define(["controller/controllers"],function(m){m.controller("task-edit",["$scope","$stateParams","$location","$controller","$q","$modal","dialogs","$filter",function(a,e,k,m,n,r,f,q){a.item={};a.CATEGORY=[];a.category=[];a.select_settings={externalIdProp:"",idProp:"NO",displayProp:"CATEGORY_NM",dynamicTitle:!1,showCheckAll:!1,showUncheckAll:!1};var p=[],l=(new Date).getFullYear();a.init=function(){for(var c=l-5;c<l+5;c++)p.push(c+"");a.years=p;a.YEAR=l+"";var b=n.defer();n.all([a.getList("cms/category",
    "list",{},{},!1).then(function(b){a.category=b;var c=[],e=[],f;for(f in b){var g=b[f];"1"==g.CATEGORY_GB&&"0"==g.CATEGORY_ST?c.push(g):"2"==g.CATEGORY_GB&&"0"==g.CATEGORY_ST&&"0"==g.PARENT_NO&&e.push(g)}a.category_a=c;a.category_b=e}),a.getList("cms/section","list",{},{YEAR:""},!1).then(function(b){a.projects=b}),a.getList("cms/section","list",{},{ROLE:!0},!1).then(function(b){a.seasons=b}),a.getList("cms/section","list",{},{},!1).then(function(b){a.sections=b})]).then(function(a){b.resolve()},function(a){b.reject(a)});
    a.format="yyyy-MM-dd";a.today=function(){a.item.CLOSE_YMD=new Date;a.item.DEPLOY_YMD=new Date};a.today();a.clear=function(){a.item.CLOSE_YMD=null};a.open=function(b,c){b.preventDefault();b.stopPropagation();a[c]=!0};return b.promise};a.$watch("CATEGORY_M",function(c){var b=[];if(void 0!=c)for(var d in a.category){var h=a.category[d];h.PARENT_NO==c.NO&&"2"==h.CATEGORY_GB&&"0"==h.CATEGORY_ST&&"0"!=h.PARENT_NO&&b.push(h)}a.category_s=b});a.click_removeCategory=function(c){a.CATEGORY.splice(c,1)};a.$watch("YEAR",
    function(c){null!=c?a.getList("cms/project","list",{},{YEAR:c},!1).then(function(b){a.projects=b;if(0==e.id)a.item.PROJECT=b[0];else for(b=0;b<a.projects.length;b++)a.item.PROJECT=a.projects[b]})["catch"](function(b){a.projects=[];console.log(b)}):a.getList("cms/project","list",{},{YEAR:""},!1).then(function(b){a.projects=b})});a.click_showTaskList=function(){k.path("/task/list")};a.getTask=function(){a.getItem("cms/task","item",e.id,{},!0).then(function(c){a.item=c;null!=c.CATEGORY&&(a.CATEGORY=
    angular.fromJson(c.CATEGORY));a.YEAR=c.YEAR;angular.forEach(a.projects,function(b,d){b.NO==c.PROJECT_NO&&(a.item.PROJECT=a.projects[d])});for(var b=0,d=0;d<a.seasons.length;d++)JSON.stringify(c.SEASON_NM)==JSON.stringify(a.seasons[d].SEASON_NM)&&(b=d);a.item.SEASON_NM=a.seasons[b];for(d=b=0;d<a.sections.length;d++)JSON.stringify(c.SECTION_NM)==JSON.stringify(a.sections[d].SECTION_NM)&&(b=d);a.item.SECTION=a.sections[b]})["catch"](function(a){f.error("\uc624\ub958",a+"",{size:"md"})})};a.$watch("item.SEASON_NM",
    function(c){null!=c?a.getList("cms/section","list",{},{SEASON_NM:c.SEASON_NM},!1).then(function(b){a.sections=b;if(0==e.id)a.item.SECTION=b[0];else for(b=0;b<a.sections.length;b++)JSON.stringify(a.item.SECTION.SECTION_NM)==JSON.stringify(a.sections[b].SECTION_NM)&&(a.item.SECTION=a.sections[b])})["catch"](function(a){f.error("\uc624\ub958",a+"",{size:"md"})}):a.getList("cms/section","list",{},{},!1).then(function(b){a.sections=b})});a.click_saveTask=function(){a.item.CATEGORY=a.CATEGORY;a.item.CLOSE_YMD=
    q("date")(a.item.CLOSE_YMD,"yyyy-MM-dd");0==e.id?a.insertItem("cms/task","item",a.item,!1).then(function(){k.url("/task/list")})["catch"](function(a){f.error("\uc624\ub958",a+"",{size:"md"})}):a.updateItem("cms/task","item",e.id,a.item,!1).then(function(){k.url("/task/list")})["catch"](function(a){f.error("\uc624\ub958",a+"",{size:"md"})})};a.initUpdate=function(){0!=e.id&&a.getTask()};a.click_selectEditor=function(){a.openModal(!0,{ROLE_ID:"IN_EDITOR, OUT_EDITOR"})};a.openModal=function(c,b,d){f.create("/partials/cms/contact-list.html",
    ["$modalInstance",function(c){a.isModal=!0;a.search=b;a.click_selectCmsUser=function(a){c.close(a)};a.click_ok=function(){c.close()}}],b,{size:d,keyboard:!0},a).result.then(function(b){a.item.EDITOR_ID=b.USER_ID;a.item.EDITOR_NM=b.USER_NM},function(){})};a.getSession().then(a.sessionCheck).then(a.permissionCheck).then(a.init).then(a.initUpdate)["catch"](a.reportProblems)}])});