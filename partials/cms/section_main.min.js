define(["controller/controllers"],function(controllers){controllers.controller("section_main",["$scope","$stateParams","$location","$filter","dialogs","ngTableParams",function($scope,$stateParams,$location,$filter,dialogs,ngTableParams){$scope.key="";$scope.item={};$scope.search={};$scope.init=function(){$scope.getList("cms/section","list",{},{ROLE:true},false).then(function(data){$scope.season=data})["catch"](function(error){alert(error)})};$scope.initUpdate=function(){if($stateParams.id!=0)$scope.getTask()};$scope.click_deleteSection=function(parentIdx,idx){var section=$scope.tableParams.data[parentIdx].data[idx];var dialog=dialogs.confirm("\uc54c\ub9bc","\uc0ad\uc81c \ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c.",{size:"md"});dialog.result.then(function(btn){$scope.deleteItem("cms/section","item",section.NO,true).then(function(){dialogs.notify("\uc54c\ub9bc","\uc815\uc0c1\uc801\uc73c\ub85c \uc0ad\uc81c\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",{size:"md"});$scope.tableParams.data[parentIdx].data.splice(idx,1);$scope.tableParams.reload();$scope.getList("cms/section","list",{},{ROLE:true},false).then(function(data){$scope.season=data})["catch"](function(error){alert(error)});$scope.click_cancel()})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"})})},function(btn){return})};$scope.click_searchSection=function(){$scope.tableParams.reload()};$scope.getSectionList=function(search){$scope.tableParams=new ngTableParams({page:1,count:1E3,sorting:{SECTION_NM:"asc",SORT_IDX:"asc"}},{groupBy:"SEASON_NM",counts:[],total:0,getData:function($defer,params){var key=Object.keys(params.sorting())[0];$scope.search["SORT"]=key;$scope.search["ORDER"]=params.sorting()[key];$scope.getList("cms/section","list",{},$scope.search,true).then(function(data){var total_cnt=data[0].TOTAL_COUNT;$scope.TOTAL_COUNT=total_cnt;params.total(total_cnt);$defer.resolve(data)})["catch"](function(error){$defer.resolve([])})}})};$scope.click_saveSection=function(){if($scope.key=="")$scope.insertItem("cms/section","item",$scope.item,false).then(function(){dialogs.notify("\uc54c\ub9bc","\uc815\uc0c1\uc801\uc73c\ub85c \ub4f1\ub85d\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",{size:"md"});$scope.tableParams.reload();$scope.getList("cms/section","list",{},{ROLE:true},false).then(function(data){$scope.season=data})["catch"](function(error){alert(error)})})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"})});else $scope.updateItem("cms/section","item",$scope.key,$scope.item,false).then(function(){dialogs.notify("\uc54c\ub9bc","\uc815\uc0c1\uc801\uc73c\ub85c \uc218\uc815\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",{size:"md"});$scope.tableParams.reload()})["catch"](function(error){dialogs.error("\uc624\ub958",error+"",{size:"md"})});$scope.key="";$scope.item={}};$scope.click_getSection=function(id){$scope.key=id;if($scope.key!="")$scope.getItem("cms/section","item",$scope.key,{},false).then(function(data){var idx=0;for(var i=0;i<$scope.season.length;i++)if(JSON.stringify(data.SEASON_NM)==JSON.stringify($scope.season[i].SEASON_NM))idx=i;$scope.item=data;$scope.item.SELECT_SEASON_NM=$scope.season[idx];$scope.season_nm_check=true;$("html,body").animate({scrollTop:$("#item").offset().top},100);$("#season_gb").focus()})["catch"](function(error){alert(error)})};$scope.click_focus=function(){$("html,body").animate({scrollTop:$("#item").offset().top},100);$("#season_gb").focus();$scope.key="";$scope.item={}};$scope.$watch("item.SELECT_SEASON_NM",function(data){if(data!=null&&data!=""){$scope.item.SEASON_NM=data.SEASON_NM;$scope.item.OLD_SEASON_NM=data.SEASON_NM;$("#old_season_nm").val(data.SEASON_NM);$("#season_upt_btn").show()}else{$scope.item.SEASON_NM="";$("#season_upt_btn").hide()}});$scope.click_updateSeason=function(){console.log("$scope.item.SEASON_NM = "+$scope.item.SEASON_NM);$scope.updateItem("cms/section","item",{},$scope.item,false).then(function(){alert("\uc2dc\uc98c\uc218\uc815\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4");$scope.tableParams.reload();$scope.getList("cms/section","list",{},{ROLE:true},false).then(function(data){$scope.season=data})["catch"](function(error){alert(error)})})["catch"](function(error){alert(error)})};$scope.click_cancel=function(){$scope.key="";$scope.item={}};$scope.$parent.message="ANGE CMS";$scope.$parent.pageTitle="\uc139\uc158 \uad00\ub9ac";$scope.$parent.pageDescription="CMS \uc139\uc158\uc744 \uad00\ub9ac\ud569\ub2c8\ub2e4.";$scope.$parent.tailDescription=".";$scope.getSession().then($scope.sessionCheck).then($scope.init).then($scope.getSectionList)["catch"]($scope.reportProblems)}])});